<%- include('layout', { body: `
    <div class="container mt-5" style="max-width: 600px;">
        <h2 class="mb-4 text-center">Edit Assignment</h2>

        <form 
            action="/assignments/edit/${assignment._id}?_method=PUT" 
            method="POST" 
            class="bg-dark p-4 rounded border border-secondary"
        >

            <div class="mb-3">
                <label class="form-label">Course</label>
                <input 
                    type="text" 
                    name="course" 
                    class="form-control" 
                    value="${assignment.course}" 
                    required
                    autofocus
                >
            </div>

            <div class="mb-3">
                <label class="form-label">Title</label>
                <input 
                    type="text" 
                    name="title" 
                    class="form-control" 
                    value="${assignment.title}" 
                    required
                >
            </div>

            <div class="mb-3">
                <label class="form-label">Due Date</label>
                <input 
                    type="date" 
                    name="dueDate" 
                    id="dueDate"
                    class="form-control"
                    value="${new Date(assignment.dueDate.getTime() - assignment.dueDate.getTimezoneOffset() * 60000).toISOString().split('T')[0]}"
                    required
                >
                <p id="daysLeft" class="mt-2"></p>
            </div>

            <div class="mb-4">
                <label class="form-label">Priority</label>
                <select 
                    name="priority" 
                    id="prioritySelect"
                    class="form-select" 
                    required
                >
                    <option value="Low" ${assignment.priority === 'Low' ? 'selected' : ''}>Low</option>
                    <option value="Medium" ${assignment.priority === 'Medium' ? 'selected' : ''}>Medium</option>
                    <option value="High" ${assignment.priority === 'High' ? 'selected' : ''}>High</option>
                </select>

                <span id="priorityBadge" class="badge mt-2"></span>
            </div>

            <div class="d-flex justify-content-between">
                <a href="/assignments" class="btn btn-secondary">Cancel</a>
                <button class="btn btn-primary">Save Changes</button>
            </div>

        </form>
    </div>

    <script>
        // Priority Badge Preview
        function updateBadge() {
            const select = document.getElementById('prioritySelect');
            const badge = document.getElementById('priorityBadge');

            if (select.value === 'High') {
                badge.textContent = 'High';
                badge.className = 'badge bg-danger mt-2';
            } else if (select.value === 'Medium') {
                badge.textContent = 'Medium';
                badge.className = 'badge bg-warning text-dark mt-2';
            } else {
                badge.textContent = 'Low';
                badge.className = 'badge bg-success mt-2';
            }
        }

        document.getElementById('prioritySelect').addEventListener('change', updateBadge);
        updateBadge(); // Load on page open

        // Days Until Due
        function updateDaysLeft() {
            const input = document.getElementById('dueDate');
            const label = document.getElementById('daysLeft');
            const due = new Date(input.value);
            const today = new Date();
            const diff = Math.ceil((due - today) / (1000 * 60 * 60 * 24));

            if (diff < 0) {
                label.textContent = 'âš  This assignment is overdue';
                label.className = 'text-danger';
            } else if (diff === 0) {
                label.textContent = 'Due today';
                label.className = 'text-warning';
            } else {
                label.textContent = diff + ' day(s) left';
                label.className = 'text-info';
            }
        }

        document.getElementById('dueDate').addEventListener('input', updateDaysLeft);
        updateDaysLeft(); // Load on page open
    </script>
` }) %>
